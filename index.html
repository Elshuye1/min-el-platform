<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Min-el | Business Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #0f172a; 
            color: white; 
            -webkit-tap-highlight-color: transparent;
        }

        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .locked-card { filter: grayscale(1) blur(3px); opacity: 0.4; pointer-events: none; }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.4s ease-out; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="pb-24 md:pb-0"> 
    
    <nav class="sticky top-0 z-50 glass px-4 py-3 md:px-8">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-blue-600 w-10 h-10 rounded-xl flex items-center justify-center font-bold shadow-lg shadow-blue-500/30">M</div>
                <h1 class="text-xl font-extrabold tracking-tighter">Min-el</h1>
            </div>
            
            <div class="hidden md:flex items-center gap-6">
                <button onclick="openModal('login')" class="font-bold text-sm hover:text-blue-400">Login</button>
                <button onclick="openModal('register')" class="bg-blue-600 px-6 py-2 rounded-full font-bold text-sm hover:bg-blue-500 transition">Get Started</button>
            </div>

            <div id="logged-in-status" class="md:hidden">
                <i class="fa fa-circle-user text-2xl text-blue-500"></i>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-6 md:py-12 lg:max-w-6xl">
        <section class="mb-10">
            <h2 class="text-3xl md:text-5xl font-black mb-2">Hello, <span class="text-blue-500">Entrepreneur</span></h2>
            <p class="text-slate-400 text-sm md:text-lg">Manage your business and grow your soul.</p>
        </section>

        <section class="mb-12">
            <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Quick Terminals</h3>
            <div class="flex overflow-x-auto gap-4 no-scrollbar pb-4 -mx-4 px-4 md:grid md:grid-cols-3 md:mx-0 md:px-0">
                
                <div id="owner-card" class="dashboard-item locked-card glass p-6 rounded-[2rem] min-w-[280px] md:min-w-0">
                    <div class="flex justify-between items-start mb-4">
                        <i class="fa fa-crown text-2xl text-blue-500"></i>
                        <span class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-1 rounded-md">ADMIN</span>
                    </div>
                    <h4 class="font-black text-lg">Owner Dashboard</h4>
                    <p class="text-slate-500 text-xs mb-6">Analyze 10% Tithe & Inventory.</p>
                    <a href="owner-dashboard.html" class="block w-full py-3 bg-blue-600 rounded-xl text-center text-sm font-bold">Open</a>
                </div>

                <div id="seller-card" class="dashboard-item locked-card glass p-6 rounded-[2rem] min-w-[280px] md:min-w-0">
                    <div class="flex justify-between items-start mb-4">
                        <i class="fa fa-cash-register text-2xl text-green-500"></i>
                        <span class="text-[10px] bg-green-500/20 text-green-400 px-2 py-1 rounded-md">SALES</span>
                    </div>
                    <h4 class="font-black text-lg">Seller POS</h4>
                    <p class="text-slate-500 text-xs mb-6">Record sales and wastage.</p>
                    <a href="seller-dashboard.html" class="block w-full py-3 bg-green-600 rounded-xl text-center text-sm font-bold">Open</a>
                </div>

                <div id="meet-card" class="dashboard-item locked-card glass p-6 rounded-[2rem] min-w-[280px] md:min-w-0">
                    <div class="flex justify-between items-start mb-4">
                        <i class="fa fa-video text-2xl text-red-500"></i>
                        <span class="text-[10px] bg-red-500/20 text-red-400 px-2 py-1 rounded-md">LIVE</span>
                    </div>
                    <h4 class="font-black text-lg">Video Meet</h4>
                    <p class="text-slate-500 text-xs mb-6">Staff strategy & calls.</p>
                    <a href="meeting-settings.html" class="block w-full py-3 bg-white/10 rounded-xl text-center text-sm font-bold">Join</a>
                </div>
            </div>
        </section>

        <section class="mb-12">
            <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Community Share</h3>
            <div class="glass rounded-[2rem] p-4 mb-6">
                <div class="flex items-center gap-3 mb-4">
                    <img src="https://ui-avatars.com/api/?name=Me&background=random" class="w-10 h-10 rounded-full border-2 border-blue-600">
                    <textarea id="post-input" placeholder="What's happening in your business?" class="bg-transparent flex-1 resize-none outline-none text-sm py-2" rows="2"></textarea>
                </div>
                <div class="flex justify-between items-center border-t border-white/10 pt-4">
                    <div class="flex gap-4 text-slate-400">
                        <button class="hover:text-blue-500"><i class="fa fa-camera"></i></button>
                        <button class="hover:text-blue-500"><i class="fa fa-location-dot"></i></button>
                    </div>
                    <button onclick="sharePost()" class="bg-blue-600 px-6 py-2 rounded-full font-bold text-sm">Post</button>
                </div>
            </div>
            <div id="feed-container" class="space-y-4"></div>
        </section>
    </main>

    <div id="auth-modal" class="hidden fixed inset-0 z-[200] flex items-end md:items-center justify-center">
        <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="glass w-full md:max-w-md rounded-t-[3rem] md:rounded-[3rem] p-8 relative animate-slide-up h-[85vh] md:h-auto overflow-y-auto">
            <h2 id="modal-title" class="text-3xl font-black mb-2 text-center text-white">Join Min-el</h2>
            <p id="modal-subtitle" class="text-center text-slate-500 text-sm mb-8">Secure Access for Owners & Sellers</p>

            <form id="auth-form" class="space-y-4">
                <div class="relative">
                    <i class="fa fa-envelope absolute left-4 top-4 text-slate-500"></i>
                    <input type="email" id="auth-email" placeholder="Gmail Address" required class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-12 pr-4 outline-none focus:ring-2 focus:ring-blue-600 text-sm text-white">
                </div>

                <div class="relative">
                    <i class="fa fa-lock absolute left-4 top-4 text-slate-500"></i>
                    <input type="password" id="pass1" placeholder="Password" required class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-12 pr-12 outline-none focus:ring-2 focus:ring-blue-600 text-sm text-white">
                    <button type="button" onclick="togglePass('pass1')" class="absolute right-4 top-4 text-slate-500"><i class="fa fa-eye"></i></button>
                </div>

                <div id="role-container">
                    <p class="text-[10px] font-bold text-slate-500 mb-2 ml-2">SELECT YOUR ROLE</p>
                    <select id="user-role" class="w-full bg-slate-900 border border-white/10 rounded-2xl py-4 px-4 font-bold text-blue-400 text-sm">
                        <option value="Owner">Business Owner</option>
                        <option value="Seller">Branch Seller</option>
                    </select>
                </div>

                <button type="submit" id="auth-submit-btn" class="w-full bg-blue-600 py-4 rounded-2xl font-black shadow-xl shadow-blue-500/20 active:scale-95 transition text-white">Verify & Enter</button>
            </form>

            <div class="mt-8">
                <p class="text-center text-xs font-bold text-slate-500 uppercase mb-4">Social Login</p>
                <div class="flex justify-center gap-4">
                    <button onclick="socialLogin('Google')" class="w-14 h-14 rounded-2xl glass flex items-center justify-center text-xl hover:text-red-500"><i class="fa-brands fa-google"></i></button>
                    <button onclick="socialLogin('Facebook')" class="w-14 h-14 rounded-2xl glass flex items-center justify-center text-xl hover:text-blue-500"><i class="fa-brands fa-facebook"></i></button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, FacebookAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDJ4AChRbBukS8kkygY6mF76kxUC3HyNiI",
            authDomain: "min-eli.firebaseapp.com",
            projectId: "min-eli",
            storageBucket: "min-eli.firebasestorage.app",
            messagingSenderId: "61590314630",
            appId: "1:61590314630:web:f75dcd8296954d8c107b07",
            measurementId: "G-Q8QSR94W7L"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- NEW: LIVE INVENTORY LISTENER ---
        function loadInventory() {
            const colRef = collection(db, "inventory");
            onSnapshot(colRef, (snapshot) => {
                console.log("ðŸ”” DATABASE UPDATED!");
                let items = [];
                snapshot.docs.forEach((doc) => {
                    items.push({ ...doc.data(), id: doc.id });
                });
                // This logs your database items to the browser console (F12)
                console.log("Current Inventory in index.html:", items);
            });
        }

        window.currentMode = 'register';
        window.openModal = function(type) {
            window.currentMode = type;
            document.getElementById('auth-modal').classList.remove('hidden');
            const title = document.getElementById('modal-title');
            const roleContainer = document.getElementById('role-container');
            
            if(type === 'login') {
                title.innerText = "Welcome Back";
                roleContainer.classList.add('hidden');
            } else {
                title.innerText = "Join Min-el";
                roleContainer.classList.remove('hidden');
            }
        };

        window.closeModal = function() { document.getElementById('auth-modal').classList.add('hidden'); };

        window.togglePass = function(id) {
            const el = document.getElementById(id);
            el.type = el.type === 'password' ? 'text' : 'password';
        };

        document.getElementById('auth-form').onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('pass1').value;
            const role = document.getElementById('user-role').value;
            const btn = document.getElementById('auth-submit-btn');

            btn.innerText = "Processing...";

            try {
                if (window.currentMode === 'register') {
                    const res = await createUserWithEmailAndPassword(auth, email, password);
                    await setDoc(doc(db, "users", res.user.uid), {
                        email: email,
                        role: role,
                        createdAt: new Date()
                    });
                    alert("Account Created! You are now logged in.");
                } else {
                    await signInWithEmailAndPassword(auth, email, password);
                }
                closeModal();
            } catch (err) {
                alert(err.message);
            } finally {
                btn.innerText = "Verify & Enter";
            }
        };

        window.socialLogin = async function(providerName) {
            const provider = providerName === 'Google' ? new GoogleAuthProvider() : new FacebookAuthProvider();
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                const userDoc = await getDoc(doc(db, "users", user.uid));
                
                if (!userDoc.exists()) {
                    const role = prompt("First time here! Are you an Owner or Seller?", "Seller");
                    await setDoc(doc(db, "users", user.uid), {
                        email: user.email,
                        role: role,
                        username: user.displayName
                    });
                }
                closeModal();
            } catch (err) {
                alert(err.message);
            }
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // START LISTENING TO INVENTORY UPON LOGIN
                loadInventory();

                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    const role = userDoc.data().role;
                    document.querySelectorAll('.dashboard-item').forEach(i => i.classList.add('locked-card'));
                    
                    if(role === 'Owner') {
                        document.getElementById('owner-card').classList.remove('locked-card');
                        document.getElementById('meet-card').classList.remove('locked-card');
                    } else {
                        document.getElementById('seller-card').classList.remove('locked-card');
                    }
                }
            }
        });
    </script>

    <script>
        function sharePost() {
            const val = document.getElementById('post-input').value;
            if(!val) return;
            const card = `<div class="glass p-5 rounded-[2rem] border-white/5 animate-slide-up">
                            <p class="text-sm text-slate-300">${val}</p>
                          </div>`;
            document.getElementById('feed-container').insertAdjacentHTML('afterbegin', card);
            document.getElementById('post-input').value = '';
        }
    </script>
</body>
</html>
